<%= form_with model: [ :admin, article ], local: true, class: "space-y-6" do |f| %>
  <%= render AlertComponent.new(type: :danger, messages: article.errors.full_messages) if article.errors.any? %>

  <div class="a--form-item">
    <%= f.label :title, "タイトル", class: "a--form-label mb-1" %>
    <%= f.text_field :title, class: "a--text-input spec--title-input" %>
  </div>

  <div class="a--form-item">
    <%= f.label :summary, "概要", class: "a--form-label mb-1" %>
    <%= f.text_area :summary, rows: 3, class: "a--text-input spec--summary-input" %>
  </div>

  <div class="a--form-item">
    <%= f.label :body, "本文 (Markdown記法)", class: "a--form-label mb-1" %>
    <div class="a--form-help mb-2">
      Markdown記法が使用できます。**太字**、*斜体*、`コード`、[リンク](URL)、見出し(#)、リスト(-)など
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-controller="markdown-preview">
      <div class="a--form-item">
        <label class="a--form-label mb-1">編集</label>
        <div class="a--form-help mb-2">
          画像をドラッグ&ドロップするか、貼り付けてアップロードできます
        </div>
        <%= f.text_area :body, rows: 15,
                        class: "a--text-input a--markdown-textarea font-mono text-sm spec--body-input js-markdown-textarea",
                        data: {
                          controller: "image-upload",
                          action: "input->markdown-preview#update keyup->markdown-preview#update dragover->image-upload#dragover dragleave->image-upload#dragleave drop->image-upload#drop",
                          image_upload_target: "textarea",                          image_upload_upload_url_value: admin_articles_upload_image_path                        } %>
      </div>
      <div class="a--form-item">
        <label class="a--form-label mb-1">プレビュー</label>
        <div class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 overflow-y-auto">
          <div data-markdown-preview-target="preview" class="a--markdown-body js-markdown-preview">
            <% if article.body.present? %>
              <%= markdown(article.body) %>
            <% else %>
              <p class="text-gray-500 italic">プレビューがここに表示されます...</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%= render ImageUploadComponent.new(
    field_name: :thumbnail,
    label: "サムネイル画像",
    upload_url: admin_site_settings_upload_image_path,
    current_image: article.thumbnail,
    form: f,
    spec_class: "thumbnail"
  ) %>

  <div class="a--form-help mt-1">
    記事のOGP画像やカード表示で使用される画像です
  </div>

  <div class="flex gap-4">
    <% if article.persisted? %>
      <% if article.draft? %>
        <%= f.submit "公開", class: "a--button is-lg is-primary spec--update-button" %>
        <%= f.submit "下書き保存", class: "a--button is-lg is-warning" %>
      <% else %>
        <%= f.submit "更新", class: "a--button is-lg is-primary spec--update-button" %>
        <%= f.submit "下書き保存", class: "a--button is-lg is-warning" %>
      <% end %>
    <% else %>
      <%= f.submit "公開", class: "a--button is-lg is-primary spec--publish-button" %>
      <%= f.submit "下書き保存", class: "a--button is-lg is-warning spec--draft-button" %>
    <% end %>
    <%= link_to "キャンセル", admin_articles_path, class: "a--button is-lg is-border-secondary spec--cancel-button" %>
  </div>
<% end %>
